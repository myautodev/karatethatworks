/*************************************************************************
* ADOBE CONFIDENTIAL
* ___________________
*
*  Copyright 2015 Adobe Systems Incorporated
*  All Rights Reserved.
*
* NOTICE:  All information contained herein is, and remains
* the property of Adobe Systems Incorporated and its suppliers,
* if any.  The intellectual and technical concepts contained
* herein are proprietary to Adobe Systems Incorporated and its
* suppliers and are protected by all applicable intellectual property laws,
* including trade secret and or copyright laws.
* Dissemination of this information or reproduction of this material
* is strictly forbidden unless prior written permission is obtained
* from Adobe Systems Incorporated.
**************************************************************************/
var def;require=function(e){"use strict";return e},def=window.define?window.define:function(e,t){"use strict";return t.apply(null,[{ajax:$.ajax.bind($)}])};var exports=acom_analytics={};function dependOn(){"use strict";return[require("util"),require("proxy"),require("common")]}def(dependOn(),(function(e,t,s){"use strict";var r,i=null;for(r in i||(i=new function(){t&&(this.proxy=t.proxy.bind(this)),this.getFeatureFlags=()=>new Promise((e,t)=>{try{try{if(this.featureFlags=sessionStorage.getItem("features"),this.featureFlags)return e(JSON.parse(this.featureFlags))}catch(e){}this.featureFlags||(this.init(),this.callFloodgateAPI().then(t=>{try{sessionStorage.setItem("features",JSON.stringify(t))}catch(e){}return e(t)}))}catch(e){t(e)}}),this.getReleaseVariant=e=>new Promise((t,s)=>this.getFeatureFlags().then(s=>{let r=null;s.releases.forEach(t=>{t.release_name===e&&(r=t.features[0])}),t(r)}).catch(()=>s(null))),this.hasFlag=e=>this.getFeatureFlags().then(t=>this.getArrayOfFlags(t).includes(e)).catch(()=>null),this.init=()=>{this.clientId=s.getViewerIMSClientId(),this.floodgateUri=s.getFloodgateuri(),this.env=s.getEnv(),this.accessToken=null,this.useAnonymousUUID=!0,this.featureFlags=[]},this.getApiUrl=()=>{const e=this.clientId;if(!this.floodgateUri||!e)throw new Error("missing data");return`${this.floodgateUri}/v3/feature?clientId=${e}&meta=false`},this.getArrayOfFlags=e=>{const t=e=>{try{if("object"==typeof window&&window.sessionStorage)return window.sessionStorage.getItem(e)||""}catch(e){return""}};if(e){this.featureFlags=[],e.releases.forEach(e=>{e.features.forEach(e=>this.featureFlags.push(e))});t("floodgate-add").split(/[, ]+/).forEach(e=>{this.featureFlags.includes(e)||this.featureFlags.push(e)});const s=t("floodgate-remove").split(/[, ]+/);this.featureFlags=this.featureFlags.filter(e=>!s.includes(e))}return this.featureFlags.slice()},this.uuid=()=>{try{var e=(new Date).getTime();return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,(function(t){var s=(e+16*Math.random())%16|0;return e=Math.floor(e/16),("x"===t?s:3&s|8).toString(16)}))}catch(e){return Math.random()}},this.createAnonUserUUID=()=>{const e=`${this.env}_${this.clientId}_${this.uuid()}`;try{localStorage.setItem("anonUserUUID",e)}catch(e){}return e},this.callFloodgateAPI=()=>{const e=this.accessToken?"Bearer "+this.accessToken:"",t={"x-api-key":this.clientId};if(this.useAnonymousUUID){try{t["x-adobe-uuid"]=localStorage.getItem("anonUserUUID")}catch(e){}t["x-adobe-uuid"]||(e?t.Authorization=e:t["x-adobe-uuid"]=this.createAnonUserUUID())}else e&&(t.Authorization=e);let s={};return fetch(this.getApiUrl(),{method:"GET",headers:t}).then(e=>{s=e;const t=e.headers.get("content-type");return e.ok&&t&&t.includes("application/json")?(this.error=void 0,e.json().then(e=>e)):e.text().then(s=>{const r=`Floodgate API failed with status ${e.status} ${e.statusText} type ${t} text ${s}`;throw new TypeError(r)})}).catch(e=>{this.error=e&&e.message?e:new Error("Floodgate failure: "+JSON.stringify(e))})}}),i)i.hasOwnProperty(r)&&("function"==typeof i[r]?exports[r]=i[r].bind(i):exports[r]=i[r]);return i}));
/*************************************************************************
* ADOBE CONFIDENTIAL
* ___________________
*
*  Copyright 2015 Adobe Systems Incorporated
*  All Rights Reserved.
*
* NOTICE:  All information contained herein is, and remains
* the property of Adobe Systems Incorporated and its suppliers,
* if any.  The intellectual and technical concepts contained
* herein are proprietary to Adobe Systems Incorporated and its
* suppliers and are protected by all applicable intellectual property laws,
* including trade secret and or copyright laws.
* Dissemination of this information or reproduction of this material
* is strictly forbidden unless prior written permission is obtained
* from Adobe Systems Incorporated.
**************************************************************************/
function dependOn(){"use strict";return[require("common"),require("util"),require("analytics")]}var def;require=function(e){"use strict";return e},def=window.define?window.define:function(e,t){"use strict";return t.apply(null,[{ajax:$.ajax.bind($)}])};var exports=acom_analytics={};def(dependOn(),(function(e,t,n){"use strict";var r=null,o=!1,i=chrome.extension.getURL("viewer.html");function a(n){!function(){try{let n=0!=communicate.version&&1!=communicate.version,r=!(!n||communicate.version===SETTINGS.READER_VER||communicate.version===SETTINGS.ERP_READER_VER);localStorage.setItem("locale",t.getFrictionlessLocale(chrome.i18n.getMessage("@@ui_locale"))),localStorage.setItem("cdnUrl",e.getAcrobatViewerUri()),localStorage.setItem("isDeskTop",n),localStorage.setItem("env",e.getEnv()),localStorage.setItem("viewerImsClientId",e.getViewerIMSClientId()),localStorage.setItem("imsURL",e.getIMSurl()),localStorage.setItem("isAcrobat",r)}catch(e){}}();let r=i;if(r+="?pdfurl="+encodeURIComponent(n.url),void 0!==n.responseHeaders){const e=l(n.responseHeaders,"content-length");e&&(r+="&clen="+e.value);const t=l(n.responseHeaders,"accept-ranges");t&&t.value&&"bytes"===t.value.toLowerCase()&&(r+="&chunk=true")}return function(e){const t=new URL(e.url),n=new URLSearchParams(t.search);let r=!1;const o=e.initiator;o&&["https://classroom.google.com","https://mail.google.com","https://drive.google.com"].includes(o)&&n.forEach((e,t)=>{t.startsWith("print")&&"true"===e&&(r=!0)});return r}(n)&&(r+="&googlePrint=true"),r}function s(e){if(!SETTINGS.IS_READER&&SETTINGS.USE_ACROBAT&&0!=communicate.version&&(1!=communicate.version||0!=t.getNMHConnectionStatus())&&e.url){const t=new URL(e.url);chrome.runtime.id===t.host?(chrome.contextMenus.update("convertPageContextMenu",{visible:!1}),chrome.contextMenus.update("appendPageContextMenu",{visible:!1})):(chrome.contextMenus.update("convertPageContextMenu",{visible:!0}),chrome.contextMenus.update("appendPageContextMenu",{visible:!0}))}}function c(e){const n=new Date;n.setMinutes(n.getMinutes()+SETTINGS.VIEWER_RECHECK_CDN_ACCESS_DELAY_MINS),t.setCookie("netAccAdT",n.getTime()),t.setCookie("netAcc",e)}chrome.tabs.onActivated.addListener((function(e){chrome.tabs.get(e.tabId,(function(e){chrome.runtime.lastError||s(e)}))}));function u(){try{return"true"===t.getCookie("pdfViewer")}catch(e){return!1}}function l(e,t){for(var n=0;n<e.length;++n){var r=e[n];if(r.name.toLowerCase()===t)return r}}function d(e,t){e&&t&&chrome.tabs.update(e,{url:t})}function m(e){if("GET"!==e.method||!SETTINGS.VIEWER_ENABLED||!u())return!1;var r=e.url;let i="reloadurl-"+e.tabId;const a=t.getCookie(i);if(a&&a===r){try{localStorage.removeItem(i)}catch(e){}return!1}if(!(e=>{if(!e||null===e||"undefined"===e)return!1;return!![/^http\:\/\/[^/]/,/^https\:\/\/[^/]/].find(t=>t.test(e))&&![/^chrome\:\/\//,/^chrome\-extension\:\/\//,/^file?:/,/^https:\/\/([a-zA-Z\d-]+\.){0,}officeapps.live.com/,/^https\:\/\/*.*\/(saml|login)/,/^https:\/\/sharedcloud.([a-zA-Z\d-]+)+.(s3|s3-accelerate).amazonaws.com/,/^https\:\/\/*.*.(login|auth|okta|saml).*\/S*|(login|auth|okta|saml|IWA|owa)\//,/^https\:\/\/www.google.com\/search\?q/,/^https\:\/\/www.citibank.*/,/^https:\/\/[^/]*\.*\/([$-/:-?{-~!"^_`\[\]A-Za-z0-9]*)view-sdk/].find(t=>t.test(e))})(r))return!1;const s=function(e){if(void 0!==e.responseHeaders){const t=l(e.responseHeaders,"content-type"),r=l(e.responseHeaders,"content-disposition");if(t){const o=t.value.toLowerCase().split(";",1)[0].trim();if(r&&/^\s*attachment[;]?/i.test(r.value))return"application/pdf"===o||"application/octet-stream"===o?n.event(n.e.VIEWER_PDF_ATTACHMENT_IGNORED):n.event(n.e.VIEWER_ATTACHMENT_IGNORED),!1;if("application/pdf"===o)return n.event(n.e.VIEWER_PDF_PROCESS_PDF),!0;if("application/octet-stream"===o){if(e.url.toLowerCase().indexOf(".pdf")>0)return n.event(n.e.VIEWER_PDF_PROCESS_OS_URL),!0;if(r&&/\.pdf(["']|$)/i.test(r.value))return n.event(n.e.VIEWER_PDF_PROCESS_OS_CD),!0}}}return!1}(e);return o?(s&&n.event(n.e.VIEWER_FALLBACK_TO_NATIVE_INCOGNITO),!1):s}chrome.tabs.onUpdated.addListener((e,t,n)=>{if(o=n.incognito,"complete"===n.status&&s(n),"loading"===t.status)try{!function(e,t){return chrome.runtime.id===e.host&&t.url.indexOf("viewer.html")>0}(new URL(n.url),n)||u()&&!o||d(e,function(e,t){t||(t=window.location.href);try{const n=new URL(t);return new URLSearchParams(n.search).get(e)}catch(e){return}}("pdfurl",n.url))}catch(e){}}),chrome.webRequest.onHeadersReceived.addListener((function(e){if("main_frame"===e.type){if(!function(){if(!window.navigator.onLine)return!1;const e=new Date,n=t.getCookie("netAcc"),r=t.getCookie("netAccAdT");return!(r&&r>e.getTime())||"true"===n}()||!m(e))return;return n.event(n.e.VIEWER_PDF_DETECT_HEADERS),r=e.url,{redirectUrl:a(e)}}var o;"sub_frame"===e.type&&(o=e.url,/^https:\/\/[^/]*(acrobat|adobe)\.com\/proxy\/chrome-viewer/.test(o))&&(200!==e.statusCode?403===e.statusCode?(t.setCookie("pdfViewer",!1),n.event(n.e.VIEWER_FALLBACK_TO_NATIVE_CDN_FORBIDDEN),d(e.tabId,r)):(c(!1),n.event(n.e.VIEWER_FALLBACK_TO_NATIVE_CDN_OFFLINE),d(e.tabId,r)):c(!0))}),{urls:["http://*/*","https://*/*"],types:["main_frame","sub_frame"]},["responseHeaders","blocking"])}));